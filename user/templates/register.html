<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <title>resgister</title>
    {%csrf_token%}
    <a href="http://localhost:8000/index" type="button">index</a>
    <!-- <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .container {
            max-width: 960px;
        }
    </style>




    <script>
        var errorName = true
        var errorPwd = true
        var errorConfirmPwd = true
        var errorCheckout = false
        var errorEmail = true
        $(function () {
            //Checking legality when out of focus
            $('#user_name').blur(function () {
                checkName()
            })
            $('#pwd').blur(function () {
                checkPwd()
            })
            $('#cpwd').blur(function () {
                checkConfirmPwd()
            })
            $('#email').blur(function () {
                checkEmail()
            })
            
            $('#allow').click(function () {
                console.log('----')

                if ($(this).is(':checked')) {
                    errorCheckout = false;
                    $(this).siblings('span').hide();
                }
                else {
                    errorCheckout = true;
                    $(this).siblings('span').html('Please check the box to agree');
                    console.log('sbsbsbsbs')
                    $(this).siblings('span').show();
                }
            });

        });
        
        function checkName() {
            console.log('checkname')
            name = $('#user_name').val().length;
            if (name == 0) {
                $('#user_name').next().html('Username cannot be empty');
                $('#user_name').next().show();
                console.log('call if ')
                errorName = true
                return;
            }
            else if (name > 15) {
                $('#user_name').next().html('Username cannot exceed 20 characters')
                $('#user_name').next().show();
                console.log('call else if ')
                errorName = true
                return;
            }
            var username = $('#user_name').val();
            // Initiate an ajax request to determine if the username has already been registered
            $.getJSON('/user/check_user/', { username: username }, function (data) {
                if (data.status == 'fail') {
                    console.log('call show ')
                    $('#user_name').next().html(data.msg);
                    console.log(data.msg)
                    // alert(data.msg)
                    $('#user_name').next().show();
                    errorName = true
                }
                else {
                    $('#user_name').next().hide();
                    errorName = false
                }
            })

        }
        //Checking the legitimacy of passwords
        function checkPwd() {
            console.log('Check password')
            pwdLength = $('#pwd').val().length;
            if (pwdLength < 6 || pwdLength > 20) {
                console.log('Check password')
                $('#pwd').next().html('Minimum 6 digits and maximum 20 digits password length')
                $('#pwd').next().show()
                errorPwd = true
                return;
            }
            else {
                $('#pwd').next().hide()
                errorPwd = false
                return;
            }
        }
        //Verify that the password entered twice is the same
        function checkConfirmPwd() {
            pwd = $('#pwd').val();
            cpwd = $('#cpwd').val();
            if (pwd != cpwd) {
                $('#cpwd').next().html('Two inconsistent password entries')
                $('#cpwd').next().show()
                errorConfirmPwd = true
            }
            else {
                $('#cpwd').next().hide()
                errorConfirmPwd = false
            }
        }
        //check email
        function checkEmail() {
            var re = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;

            if (re.test($('#email').val())) {
                $('#email').next().hide();
                errorEmail = false;
            }
            else {
                $('#email').next().html('The email you entered is not in the correct format')
                $('#email').next().show();
                errorEmail = true;
            }
        }
        //Checking input legitimacy when sending a post request
        $(function () {
            $('#reg_form').submit(function () {
                //     alert('jiance')
                checkName()
                checkPwd()
                checkConfirmPwd()
                checkEmail()
                if (errorName == false && errorPwd == false && errorConfirmPwd == false && errorEmail == false && errorCheckout == false) {
                    // Validation successful, submit
                    return true
                }
                // Validation is unsuccessful and the default behaviour of the form is blocked.
                return false

            })
        })
        $(function () {
            $file = $("#userimg")
            $file.change(function () {
                var formData = new FormData();
                formData.append('file', $('#userimg')[0].files[0]); 
                // alert(formData)
                $.ajax({        
                    url: "http://127.0.0.1:8000/user/userimg_upload",
                    type: "POST",
                    cache: false,
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        //alert(data)
                    },
                    fail: function (data) {
                        // alert("++++++++++++++++")
                    }
                });
            });
        });



    </script>




</head>

<body class="bg-light">

    <div class="container">
        <main>
            {%csrf_token%}

            <div class="row g-5" style="margin:0 auto;">

                <div class="d-block mx-auto mb-4">


                    <form action="" method="post" id="reg_form">
                        {% csrf_token %}
          
                        <div class="col-12">
                            <label class="form-label">username</label>
                            <div class="input-group has-validation">

                                <input type="text" class="form-control" id="user_name" name="user_name"
                                    placeholder="Username" required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>

                       
                        <div class="col-12">
                            <label class="form-label">password</label>
                            <div class="input-group has-validation">

                                <input type="password" class="form-control" id="pwd" name="pwd"
                                    placeholder="password" required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">confirmPassword</label>
                            <div class="input-group has-validation">

                                <input type="password" class="form-control" id="cpwd" name="cpwd"
                                    placeholder="confirmPassword" required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">email</label>
                            <div class="input-group has-validation">

                                <input type="text" class="form-control" id="email" name="email" placeholder="email"
                                    required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">age</label>
                            <div class="input-group has-validation">

                                <input type="number" class="form-control" id="age" name="age" placeholder="age"
                                    required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>

                        
                        <div class="col-12">
                            <label class="form-label">IMG</label>
                            <div class="input-group has-validation">

                                <input language="en" type="file" class="form-control" id="userimg" name="userimg" required>
                                <div class="invalid-feedback">
                                    Your username is required.
                                </div>
                            </div>
                        </div>
                       
                        <hr class="my-4">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="allow" name="allow" checked="checked">
                            <label class="form-check-label">I agree to the User Agreement</label>
                            <span class="invalid-feedback"></span>
                        </div>
                        <hr class="my-4">
                       
                        <button class="w-100 btn btn-primary btn-lg" type="submit">resgister</button>
                    </form>
                </div>
            </div>
          



        </main>
    </div>

</body>

</html>
